# Backup script

Этот репозиторий содержит скрипт бэкапа и его развертывание на языке bash. Скрипт предназначен для создания резервных копий файлов и базы данных(полных и инкрементальных), а также их периодического удаления в соответствии с заданными правилами.

# Использование

1. Установите зависимости:
	- Убедитесь, что у вас установлен PostgreSQL для создания резервной копии базы данных.
	- Убедитесь, что у вас установлен tar для создания архивов файлового бэкапа.
	- Убедитесь, что у вас установлен ssh для взаимодействия и удаления старых резервных копий на удаленных серверах.
2. Настройте переменные:
	- `SITE_CORE` - путь к корневой директории сайта.
	- `SITE` - имя сайта.
	- `SERVER_BACKUP` - SSH-адрес сервера для хранения полных резервных копий.
	- `STAGE` - SSH-адрес сервера для хранения и развертывание самой свежей(полной) версии.
	- `BACKUP_DIR` - локальная директория для хранения резервных копий.
	- `BACKUP_DIR_SERVER` - директория на сервере для хранения полных резервных копий.
	- `BACKUP_DIR_STAGE` - директория на стейдже для хранения полной резервной копии.
	- `DB_NAME` - имя базы данных
	- `HOST_NAME` - имя хоста
	- `WEEKLY_DIR` - директория на сервере бэкапов для хранения еженедельных резервных копий.
	- `MONTHLY_DIR` - директория на сервере бэкапов для хранения ежемесячных резервных копий.
	- `QUARTERLY_DIR` - директория на сервере бэкапов для хранения ежеквартальных резервных копий.
3. Запустите скрипт:
	- `./backup.sh`

## Конфигурация

- Суббота: Полная резервная копия базы данных и файлов сайта, удаление предыдущих полных резервных копий.
- Остальные дни недели: Инкрементальная резервная копия базы данных и файлов сайта, если существует предыдущая полная резервная копия.

## Удаление старых резервных копий

- На стейдже: Удаляются резервные копии, старше 7 дней.
- На сервере бэкапов:
	- Еженедельные резервные копии, хранящиеся в директории $WEEKLY_DIR, удаляются, если они старше 30 дней.
	- Ежемесячные резервные копии, хранящиеся в директории $MONTHLY_DIR, удаляются, если они старше 90 дней.
	- Ежеквартальные резервные копии, хранящиеся в директории $QUARTERLY_DIR, удаляются, если они старше 365 дней.

## Примечания

- Предоставьте необходимые разрешения на чтение, запись и выполнение скрипта перед его запуском.
- Убедитесь, что у вас есть необходимые зависимости и права доступа для выполнения всех операций бэкапа и удаления.
- Рекомендуется настроить автоматическое выполнение скрипта в соответствии с вашими требованиями, например, с использованием планировщика задач cron.

## Важно

- Перед использованием скрипта рекомендуется протестировать его на тестовом окружении, чтобы убедиться в его правильной работе и соответствии вашим требованиям.
- Автор не несет ответственности за любые возможные проблемы, возникшие в результате использования этого скрипта. Пожалуйста, используйте его на свой страх и риск.